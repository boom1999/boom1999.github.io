<!DOCTYPE html>


<html lang="en">


<head>
  <meta name="google-site-verification" content="QbUVAi0K2ZB_P4A6jbbi-GVB4BXs3n6GqgIEGHlySnk" />
  <meta charset="utf-8" />
   
  <meta name="keywords" content="Torch, Summary, UAV, Git" />
   
  <meta name="description" content="No fear of words,no fear of years" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    Lucene search engine |  Haisenberg
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">
  
<link rel="stylesheet" href="/css/custom.css">

  
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
  
  

  


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Haisenberg" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Lucene search engine"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Lucene search engine
</h1>
 

    </header>
     
    <div class="article-meta">
      <a href="/2024/08/10/Lucene%20search%20engine/" class="article-date">
  <time datetime="2024-08-10T00:00:00.000Z" itemprop="datePublished">2024-08-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Summary/">Summary</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> Word count:</span>
            <span class="post-count">4.2k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> Reading timeâ‰ˆ</span>
            <span class="post-count">19 min</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><strong>Elasticsearch</strong>æ˜¯ä¸€ä¸ªåŸºäº<strong>Lucene</strong>çš„æœç´¢å¼•æ“ï¼Œæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäº<code>RESTful API</code>æ¥å£ï¼Œè§£å†³äº†åŸç”Ÿ<code>Lucene</code>ä½¿ç”¨ä¸Šçš„ç¼ºé™·ã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£<code>Elasticsearch</code>ï¼Œå…ˆå¯¹<code>Lucene</code>è¿›è¡Œäº†è§£ã€‚</p>
</blockquote>
<span id="more"></span>
<h2 id="books-å…¨æ–‡æ£€ç´¢"><a href="#books-å…¨æ–‡æ£€ç´¢" class="headerlink" title=":books: å…¨æ–‡æ£€ç´¢"></a><span class="github-emoji"><span>ğŸ“š</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4da.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å…¨æ–‡æ£€ç´¢</h2><ul>
<li><p>ç»“æ„åŒ–æ•°æ®ï¼Œå…·æœ‰å›ºå®šæ ¼å¼æˆ–æœ‰é™é•¿åº¦çš„æ•°æ®ï¼Œå¦‚æ•°æ®åº“è¡¨ä¸­çš„å­—æ®µå’Œå…ƒæ•°æ®ã€‚</p>
<ul>
<li>æ•°æ®åº“ç”¨<code>SQL</code>è¯­å¥æœç´¢ï¼›å…ƒæ•°æ®ç”¨ç±»å‹ã€å±æ€§ã€æ ‡ç­¾ç­‰æœç´¢ã€‚</li>
</ul>
</li>
<li><p>éç»“æ„åŒ–æ•°æ®ï¼Œä¸å®šé•¿æˆ–æ— å›ºå®šæ ¼å¼çš„æ•°æ®ï¼Œå¦‚é‚®ä»¶ã€Word æ–‡æ¡£ã€PDF æ–‡æ¡£ç­‰ï¼Œåˆç§°<strong>å…¨æ–‡æ•°æ®</strong>ã€‚</p>
<ul>
<li><strong>é¡ºåºæ‰«ææ³•(Serial Scanning)</strong>ï¼Œå¯¹æ¯ä¸ªæ–‡æ¡£ä»å¤´åˆ°å°¾æ‰«æï¼Œéç»“æ„åŒ–æ•°æ®åœ¨æ•°æ®é‡å¤§æ—¶æ•ˆç‡ä½ä¸‹ï¼Œä¸é€‚åˆå…¨æ–‡æ£€ç´¢ã€‚</li>
<li><strong>å…¨æ–‡æ£€ç´¢(Full-text Search)</strong>ï¼ŒæŠŠéç»“æ„åŒ–æ•°æ®è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®ï¼Œå†ç”¨ç»“æ„åŒ–æ•°æ®çš„æ£€ç´¢æ–¹æ³•ã€‚é¦–å…ˆå°†è¦æŸ¥è¯¢çš„ç›®æ ‡æ•°æ®ä¸­çš„è¯æå–å‡ºæ¥ï¼Œç»„æˆç´¢å¼•ï¼Œé€šè¿‡æŸ¥è¯¢ç´¢å¼•è¾¾åˆ°æœç´¢ç›®æ ‡æ•°æ®çš„ç›®çš„ã€‚</li>
</ul>
</li>
</ul>
<p>StringField å’Œ TextField æ˜¯ Apache Lucene ä¸­ç”¨äºå­˜å‚¨å’Œç´¢å¼•æ–‡æ¡£å­—æ®µçš„ä¸¤ç§ä¸åŒç±»å‹ã€‚  </p>
<ul>
<li>StringFieldï¼šç”¨äºå­˜å‚¨ä¸éœ€è¦è¿›è¡Œå…¨æ–‡æœç´¢çš„å­—æ®µã€‚å®ƒä¸ä¼šè¢«åˆ†è¯å™¨å¤„ç†ï¼Œé€‚ç”¨äºç²¾ç¡®åŒ¹é…æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼ŒIDã€æ—¥æœŸã€åˆ†ç±»ç­‰å­—æ®µã€‚</li>
<li>TextFieldï¼šç”¨äºå­˜å‚¨éœ€è¦è¿›è¡Œå…¨æ–‡æœç´¢çš„å­—æ®µã€‚å®ƒä¼šè¢«åˆ†è¯å™¨å¤„ç†ï¼Œé€‚ç”¨äºéœ€è¦è¿›è¡Œå…¨æ–‡æœç´¢çš„æ–‡æœ¬å†…å®¹ã€‚ä¾‹å¦‚ï¼Œæ–‡ç« å†…å®¹ã€æè¿°ç­‰å­—æ®µã€‚<br>ç¤ºä¾‹ä»£ç ï¼š</li>
</ul>
<h2 id="mag-right-LuceneåŸºæœ¬åŸç†"><a href="#mag-right-LuceneåŸºæœ¬åŸç†" class="headerlink" title=":mag_right:LuceneåŸºæœ¬åŸç†"></a><span class="github-emoji"><span>ğŸ”</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f50e.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>Lucene</code>åŸºæœ¬åŸç†</h2><h3 id="å€’æ’ç´¢å¼•-Inverted-index"><a href="#å€’æ’ç´¢å¼•-Inverted-index" class="headerlink" title="å€’æ’ç´¢å¼•(Inverted index)"></a>å€’æ’ç´¢å¼•(Inverted index)</h3><blockquote>
<p>å¿«é€ŸæŸ¥è¯¢æŸä¸ªè¯åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®ï¼Œå°†æ–‡æ¡£é›†åˆä¸­çš„æ¯ä¸ªè¯éƒ½æ˜ å°„åˆ°å‡ºç°åœ¨è¯¥æ¬¡çš„æ–‡æ¡£åˆ—è¡¨ï¼Œè€Œä¸æ˜¯å°†æ–‡æ¡£æ˜ å°„åˆ°è¯çš„åˆ—è¡¨</p>
</blockquote>
<ol>
<li>æ–‡æ¡£åˆ†è¯ï¼šå°†æ–‡æ¡£è¿›è¡Œåˆ†è¯ï¼Œå¾—åˆ°è¯é¡¹åˆ—è¡¨ï¼Œè¿™é‡Œå¯ä»¥è¿˜æœ‰å¤§å°å†™è½¬åŒ–ã€å»åœç”¨è¯ç­‰æ“ä½œã€‚</li>
<li>æ„å»ºç´¢å¼•è¡¨ï¼šå°†è¯é¡¹åˆ—è¡¨æ„å»ºå€’æ’ç´¢å¼•è¡¨ï¼Œè®°å½•æ¯ä¸ªè¯é¡¹å‡ºç°åœ¨å“ªäº›æ–‡æ¡£ä¸­ã€‚éå†æ‰€æœ‰æ–‡æ¡£ï¼Œå¯¹æ¯ä¸ªè¯å°†å…¶æ˜ å°„åˆ°æ–‡æ¡£åˆ—è¡¨ï¼Œå¯ä»¥ç”¨å“ˆå¸Œè¡¨ã€æ ‘ç­‰æ•°æ®ç»“æ„ã€‚</li>
<li>ä¼˜åŒ–ç´¢å¼•ï¼šå¯¹ç´¢å¼•è¡¨è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚å‹ç¼©ã€æ’åºã€åˆå¹¶ç­‰æ“ä½œã€‚</li>
<li>æŸ¥è¯¢å¤„ç†ï¼šç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ£€ç´¢è¯æ—¶ï¼Œå¯¹æŸ¥è¯¢è¿›è¡Œåˆ†è¯ï¼Œå¾—åˆ°æŸ¥è¯¢è¯é¡¹åˆ—è¡¨ï¼Œç„¶ååœ¨ç´¢å¼•è¡¨ä¸­æŸ¥æ‰¾æ¯ä¸ªè¯é¡¹å¯¹åº”çš„æ–‡æ¡£åˆ—è¡¨ï¼Œæœ€åå¯¹æ–‡æ¡£åˆ—è¡¨è¿›è¡Œç­›é€‰ã€æ’åºã€äº¤é›†ã€å¹¶é›†ç­‰æ“ä½œï¼Œå¾—åˆ°æœ€ç»ˆçš„æŸ¥è¯¢ç»“æœã€‚</li>
</ol>
<h3 id="æ®µè½ç´¢å¼•-Segment-index"><a href="#æ®µè½ç´¢å¼•-Segment-index" class="headerlink" title="æ®µè½ç´¢å¼•(Segment index)"></a>æ®µè½ç´¢å¼•(Segment index)</h3><blockquote>
<p>ä¸ºäº†æé«˜æœç´¢æ•ˆç‡ï¼Œå°†ç´¢å¼•åˆ†ä¸ºå¤šä¸ªæ®µè½ï¼Œæ¯ä¸ªæ®µè½éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç´¢å¼•å•å…ƒï¼Œæ¯ä¸ªæ®µè½éƒ½æœ‰è‡ªå·±çš„å€’æ’ç´¢å¼•è¡¨ã€‚</p>
</blockquote>
<ol>
<li>åˆ†å‰²æ–‡æœ¬ï¼šåˆ†è¯å™¨çš„ç»„ä»¶å°†æ–‡æœ¬åˆ†å‰²æˆè‹¥å¹²ä¸ªæ®µè½ï¼Œå¯ä»¥æŒ‰ç…§å…·ä½“çš„éœ€æ±‚æ¥å®šä¹‰åˆ†å‰²è§„åˆ™ï¼Œä¾‹å¦‚ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·ç­‰ã€‚</li>
<li>å»ºç«‹è¯æ±‡è¡¨ï¼šLuceneå¯¹è¯æ±‡è¡¨è¿›è¡Œæ’åºç­‰ä»¥æé«˜æœç´¢æ•ˆç‡ã€‚</li>
<li>æ„å»ºå€’æ’ç´¢å¼•ï¼šå¯¹æ¯ä¸ªæ®µè½æ„å»ºå€’æ’ç´¢å¼•è¡¨ï¼Œè®°å½•æ¯ä¸ªè¯é¡¹å‡ºç°åœ¨å“ªäº›æ–‡æ¡£ä¸­ã€‚å€’æ’ç´¢å¼•çš„æ•°æ®ç»“æ„åŒ…æ‹¬ç´¢å¼•è¯é¡¹(Term)ã€æ–‡æ¡£ç¼–å·(Document ID)ã€ä½ç½®(Position)ç­‰ã€‚</li>
<li>æœç´¢ï¼šç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ£€ç´¢è¯æ—¶ï¼ŒLuceneåœ¨è¯æ±‡è¡¨ä¸­æŸ¥æ‰¾ï¼Œå¹¶è·å–åˆ°åŒ…å«è¯¥å•è¯çš„æ®µè½åˆ—è¡¨ï¼Œç„¶åæ ¹æ®è¿™äº›æ®µè½åˆ—è¡¨è®¡ç®—ç›¸å…³åº¦å¾—åˆ†ï¼Œå¹¶æŒ‰ç…§ç›¸å…³åº¦æ’åºè¿”å›æœç´¢ç»“æœã€‚</li>
</ol>
<h3 id="æ–‡æœ¬é¢„å¤„ç†"><a href="#æ–‡æœ¬é¢„å¤„ç†" class="headerlink" title="æ–‡æœ¬é¢„å¤„ç†"></a>æ–‡æœ¬é¢„å¤„ç†</h3><blockquote>
<p>åœ¨æ„å»ºç´¢å¼•ä¹‹å‰ï¼Œéœ€è¦å¯¹æ–‡æœ¬è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬åˆ†è¯ã€å¤§å°å†™è½¬åŒ–ã€å»åœç”¨è¯ç­‰æ“ä½œã€‚</p>
</blockquote>
<ol>
<li>å°å†™è½¬æ¢(Lowercasing)ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºå°å†™ï¼Œé¿å…å¤§å°å†™ä¸ä¸€è‡´å¯¼è‡´çš„æœç´¢é—®é¢˜ã€‚</li>
<li>å»é™¤åœç”¨è¯(Stopwords)ï¼šå»é™¤å¸¸ç”¨è¯ï¼Œå¦‚â€œçš„â€ã€â€œæ˜¯â€ã€â€œåœ¨â€ã€â€œandâ€ã€â€œtheâ€ç­‰ï¼Œé¿å…è¿™äº›è¯å¯¹æœç´¢ç»“æœçš„å½±å“ã€‚</li>
<li>è¯æ ¹æå–(Stemming)ï¼šå°†è¯æ±‡è¿˜åŸä¸ºè¯æ ¹ï¼Œå¦‚â€œrunningâ€è¿˜åŸä¸ºâ€œrunâ€ã€‚</li>
<li>åŒä¹‰è¯æ‰©å±•(Synonyms)ï¼šå°†åŒä¹‰è¯æ˜ å°„åˆ°åŒä¸€ä¸ªè¯é¡¹ï¼Œå¦‚â€œcarâ€å’Œâ€œautomobileâ€æ˜ å°„åˆ°åŒä¸€ä¸ªè¯é¡¹ã€‚</li>
</ol>
<h2 id="bulb-æœç´¢ç®—æ³•"><a href="#bulb-æœç´¢ç®—æ³•" class="headerlink" title=":bulb:æœç´¢ç®—æ³•"></a><span class="github-emoji"><span>ğŸ’¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4a1.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>æœç´¢ç®—æ³•</h2><h3 id="BM25ç®—æ³•"><a href="#BM25ç®—æ³•" class="headerlink" title="BM25ç®—æ³•"></a>BM25ç®—æ³•</h3><blockquote>
<p>BM25ç®—æ³•æ˜¯ä¸€ç§åŸºäºæ¦‚ç‡æ£€ç´¢æ¨¡å‹çš„æœç´¢ç®—æ³•ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºè¯é¢‘å’Œæ–‡æ¡£é•¿åº¦çš„æœç´¢ç®—æ³•ï¼Œé€‚ç”¨äºå¤§å‹æ–‡æœ¬æ•°æ®é›†çš„æœç´¢ï¼Œè€ƒè™‘äº†æ–‡æ¡£ä¸­å„é¡¹è¯çš„æƒé‡ã€è¯é¢‘ã€æ–‡æ¡£é•¿åº¦ç­‰å› ç´ ï¼Œæ ¹æ®<strong>æ–‡æ¡£å’ŒæŸ¥è¯¢</strong>ä¹‹é—´çš„å…³ç³»æ¥è¯„ä¼°æ–‡æ¡£çš„ç›¸å…³æ€§ï¼Œå¹¶æŒ‰ç…§ç›¸å…³æ€§è¿›è¡Œæ’åºã€‚</p>
</blockquote>
<p>è¯„åˆ†å…¬å¼ï¼š<script type="math/tex">\text{score}(D, Q) = \sum_{i=1}^{n} \text{IDF}(q_i) \cdot \frac{f(q_i, D) \cdot (k_1 + 1)}{f(q_i, D) + k_1 \cdot (1 - b + b \cdot \frac{|D|}{\text{avgdl}})}</script></p>
<p>å…¶ä¸­ï¼š$D$è¡¨ç¤ºæ–‡æ¡£ï¼Œ$Q$è¡¨ç¤ºæŸ¥è¯¢ï¼Œ$n$è¡¨ç¤ºæŸ¥è¯¢ä¸­çš„è¯é¡¹æ•°é‡ï¼Œ$q_i$è¡¨ç¤ºæŸ¥è¯¢ä¸­çš„ç¬¬$i$ä¸ªè¯é¡¹ï¼Œ$f(q_i, D)$è¡¨ç¤ºè¯é¡¹$q_i$åœ¨æ–‡æ¡£$D$ä¸­çš„è¯é¢‘ï¼Œ$k_1$å’Œ$b$æ˜¯è°ƒèŠ‚å‚æ•°ï¼Œ$avgdl$è¡¨ç¤ºæ–‡æ¡£é›†åˆçš„å¹³å‡é•¿åº¦ã€‚</p>
<h3 id="TF-IDFç®—æ³•-Term-Frequency-Inverse-Document-Frequency"><a href="#TF-IDFç®—æ³•-Term-Frequency-Inverse-Document-Frequency" class="headerlink" title="TF-IDFç®—æ³•(Term Frequency-Inverse Document Frequency)"></a>TF-IDFç®—æ³•(Term Frequency-Inverse Document Frequency)</h3><blockquote>
<p>TF-IDFç®—æ³•æ˜¯ä¸€ç§ç”¨äºè¯„ä¼°ä¸€ä¸ªè¯å¯¹äºä¸€ä¸ªæ–‡ä»¶é›†æˆ–ä¸€ä¸ªè¯­æ–™åº“ä¸­æŸä¸ªæ–‡ä»¶çš„é‡è¦ç¨‹åº¦çš„ç»Ÿè®¡æ–¹æ³•ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯å¦‚æœæŸä¸ªè¯åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å‡ºç°çš„é¢‘ç‡é«˜ï¼Œå¹¶ä¸”åœ¨å…¶ä»–æ–‡ç« ä¸­å‡ºç°çš„é¢‘ç‡ä½ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªè¯å…·æœ‰å¾ˆå¥½çš„åŒºåˆ†èƒ½åŠ›ï¼Œæ˜¯è¿™ç¯‡æ–‡ç« çš„å…³é”®è¯ã€‚</p>
</blockquote>
<ul>
<li>TF(Term Frequency)ï¼šè¯é¢‘ï¼Œè¡¨ç¤ºæŸä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¢‘ç‡ï¼Œè®¡ç®—å…¬å¼ä¸º<script type="math/tex">\text{TF}(t, d) = \frac{f(t, d)}{\sum_{t' \in d} f(t', d)}</script></li>
<li>IDF(Inverse Document Frequency)ï¼šé€†æ–‡æ¡£é¢‘ç‡ï¼Œè¡¨ç¤ºæŸä¸ªè¯åœ¨æ–‡æ¡£é›†åˆä¸­çš„åŒºåˆ†èƒ½åŠ›ï¼Œè®¡ç®—å…¬å¼ä¸º<script type="math/tex">\text{IDF}(t, D) = \log \frac{N}{\text{DF}(t, D)}</script></li>
<li>TF-IDFï¼šç»¼åˆè€ƒè™‘è¯é¢‘å’Œé€†æ–‡æ¡£é¢‘ç‡ï¼Œè®¡ç®—å…¬å¼ä¸º<script type="math/tex">\text{TF-IDF}(t, d, D) = \text{TF}(t, d) \cdot \text{IDF}(t, D)</script></li>
</ul>
<h3 id="ç©ºé—´å‘é‡æ¨¡å‹-Vector-Space-Model"><a href="#ç©ºé—´å‘é‡æ¨¡å‹-Vector-Space-Model" class="headerlink" title="ç©ºé—´å‘é‡æ¨¡å‹(Vector Space Model)"></a>ç©ºé—´å‘é‡æ¨¡å‹(Vector Space Model)</h3><blockquote>
<p>ç©ºé—´å‘é‡æ¨¡å‹æ˜¯ä¸€ç§åŸºäºå‘é‡ç©ºé—´çš„æœç´¢ç®—æ³•ï¼Œå°†æ–‡æ¡£å’ŒæŸ¥è¯¢è¡¨ç¤ºä¸ºå‘é‡ï¼Œé€šè¿‡è®¡ç®—å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦æ¥è¯„ä¼°æ–‡æ¡£çš„ç›¸å…³æ€§ã€‚</p>
</blockquote>
<h4 id="ä½™å¼¦ç›¸ä¼¼åº¦-Cosine-Similarity"><a href="#ä½™å¼¦ç›¸ä¼¼åº¦-Cosine-Similarity" class="headerlink" title="ä½™å¼¦ç›¸ä¼¼åº¦(Cosine Similarity)"></a>ä½™å¼¦ç›¸ä¼¼åº¦(Cosine Similarity)</h4><ul>
<li>åŸºäºå‘é‡çš„å¤¹è§’æ¥è¡¡é‡æ–‡æ¡£å’ŒæŸ¥è¯¢çš„ç›¸ä¼¼åº¦ï¼Œè®¡ç®—æ–‡æ¡£å‘é‡å’ŒæŸ¥è¯¢å‘é‡çš„å†…ç§¯é™¤ä»¥ä¸¤ä¸ªå‘é‡çš„æ¨¡é•¿çš„ä¹˜ç§¯ï¼Œè®¡ç®—å…¬å¼ä¸º<script type="math/tex">\text{Cosine Similarity}(D, Q) = \frac{D \cdot Q}{\|D\| \cdot \|Q\|}</script>ï¼Œå…¶ä¸­$D$è¡¨ç¤ºæ–‡æ¡£å‘é‡ï¼Œ$Q$è¡¨ç¤ºæŸ¥è¯¢å‘é‡ï¼Œå–å€¼èŒƒå›´ä¸º$[-1, 1]$ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºç›¸ä¼¼åº¦è¶Šé«˜ã€‚</li>
</ul>
<h4 id="Jaccardç›¸ä¼¼åº¦-Jaccard-Similarity"><a href="#Jaccardç›¸ä¼¼åº¦-Jaccard-Similarity" class="headerlink" title="Jaccardç›¸ä¼¼åº¦(Jaccard Similarity)"></a>Jaccardç›¸ä¼¼åº¦(Jaccard Similarity)</h4><ul>
<li>åŸºäºå‘é‡çš„äº¤é›†å’Œå¹¶é›†æ¥è¡¡é‡æ–‡æ¡£å’ŒæŸ¥è¯¢çš„ç›¸ä¼¼åº¦ï¼Œè®¡ç®—æ–‡æ¡£å‘é‡å’ŒæŸ¥è¯¢å‘é‡çš„äº¤é›†é™¤ä»¥ä¸¤ä¸ªå‘é‡çš„å¹¶é›†ï¼Œè®¡ç®—å…¬å¼ä¸º<script type="math/tex">\text{Jaccard Similarity}(D, Q) = \frac{|D \cap Q|}{|D \cup Q|}</script>ï¼Œå–å€¼èŒƒå›´ä¸º$[0, 1]$ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºç›¸ä¼¼åº¦è¶Šé«˜ã€‚</li>
</ul>
<h2 id="computer-Coding"><a href="#computer-Coding" class="headerlink" title=":computer:Coding"></a><span class="github-emoji"><span>ğŸ’»</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4bb.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>Coding</h2><h3 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- luceneæ ¸å¿ƒåŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>${lunece.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- luceneæŸ¥è¯¢è§£æåŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-queryparser<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>${lunece.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- luceneåˆ†è¯å™¨åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-analyzers-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>${lunece.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- test --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="ä»æ–‡ä»¶æ„å»ºç´¢å¼•å’Œæ£€ç´¢"><a href="#ä»æ–‡ä»¶æ„å»ºç´¢å¼•å’Œæ£€ç´¢" class="headerlink" title="ä»æ–‡ä»¶æ„å»ºç´¢å¼•å’Œæ£€ç´¢"></a>ä»æ–‡ä»¶æ„å»ºç´¢å¼•å’Œæ£€ç´¢</h3><h4 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h4><ul>
<li>åœ¨èµ„æºç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>data</code>ç›®å½•ï¼Œç”¨äºå­˜æ”¾æ–‡æ¡£æ•°æ®ï¼Œè¿™é‡Œç”¨äº†é›…æ€çš„ä¸‰æ®µè¯ä½œä¸ºç¤ºä¾‹æ•°æ®$1.txt$ï¼Œ$2.txt$ï¼Œ$3.txt$ã€‚</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/JavaProjects/luceneDemo/src/main/resources/data</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Many procedures are available for obtaining data about a language. They range from a carefully planned, intensive field investigation in a foreign country to a casual introspection about oneâ€™s mother tongue carried out in an armchair at home."</span> &gt; ~/JavaProjects/luceneDemo/src/main/resources/data/1.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"In all cases, someone has to act as a source of language data â€“ an informant. Informants are (ideally) native speakers of a language, who provide utterances for analysis and other kinds of information about the language (e.g. translations, comments about correctness, or judgements on usage). Often, when studying their mother tongue, linguists act as their own informants, judging the ambiguity, acceptability, or other properties of utterances against their own intuitions. The convenience of this approach makes it widely used, and it is considered the norm in the generative approach to linguistics. But a linguistâ€™s personal judgements are often uncertain, or disagree with the judgements of other linguists, at which point recourse is needed to more objective methods of enquiry, using non-linguists as informants. The latter procedure is unavoidable when working on foreign languages, or child speech."</span> &gt; ~/JavaProjects/luceneDemo/src/main/resources/data/2.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Many factors must be considered when selecting informants â€“ whether one is working with single speakers (a common situation when languages have not been described before), two people interacting, small groups or large-scale samples. Age, sex, social background and other aspects of identity are important, as these factors are known to influence the kind of language used. The topic of conversation and the characteristics of the social setting (e.g. the level of formality) are also highly relevant, as are the personal qualities of the informants (e.g. their fluency and consistency). For larger studies, scrupulous attention has been paid to the sampling theory employed, and in all cases, decisions have to be made about the best investigative techniques to use."</span> &gt; ~/JavaProjects/luceneDemo/src/main/resources/data/3.txt</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ„å»ºç´¢å¼•"><a href="#æ„å»ºç´¢å¼•" class="headerlink" title="æ„å»ºç´¢å¼•"></a>æ„å»ºç´¢å¼•</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.standard.StandardAnalyzer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.FSDirectory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Indexer</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IndexWriter writer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Indexer</span><span class="params">(String indexDir)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="type">Directory</span> <span class="variable">dir</span> <span class="operator">=</span> FSDirectory.open(Paths.get(indexDir));</span><br><span class="line">        <span class="comment">// StandardAnalyzeræ ‡å‡†åˆ†è¯å™¨ï¼Œå°†å¿½ç•¥isï¼Œaï¼Œtheç­‰å•è¯</span></span><br><span class="line">        <span class="type">IndexWriterConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(<span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>());</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–å†™ç´¢å¼•å¯¹è±¡</span></span><br><span class="line">        writer = <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(dir, config);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­ç´¢å¼•å†™å…¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        writer.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç´¢å¼•dataDirç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexALl</span><span class="params">(String dataDir)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        File[] files = <span class="keyword">new</span> <span class="title class_">File</span>(dataDir).listFiles();</span><br><span class="line">        <span class="keyword">assert</span> files != <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (File file : files) {</span><br><span class="line">            indexFile(file);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> writer.numDocs();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç´¢å¼•å•ä¸ªæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">indexFile</span><span class="params">(File file)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        System.out.println(<span class="string">"Indexing "</span> + file.getCanonicalPath());</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> getDocument(file);</span><br><span class="line">        <span class="comment">// å°†æ–‡æ¡£å†™å…¥ç´¢å¼•</span></span><br><span class="line">        writer.addDocument(doc);</span><br><span class="line">        writer.commit();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æŸä¸ªæ–‡ä»¶çš„æ–‡æ¡£</span></span><br><span class="line">    <span class="keyword">private</span> Document <span class="title function_">getDocument</span><span class="params">(File file)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">        doc.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">"contents"</span>, <span class="keyword">new</span> <span class="title class_">FileReader</span>(file)));</span><br><span class="line">        doc.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">"fileName"</span>, file.getName(), TextField.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">"fullPath"</span>, file.getCanonicalPath(), TextField.Store.YES));</span><br><span class="line">        <span class="keyword">return</span> doc;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">indexDir</span> <span class="operator">=</span> <span class="string">"~/JavaProjects/luceneDemo/src/main/resources/Index"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">dataDir</span> <span class="operator">=</span> <span class="string">"~/JavaProjects/luceneDemo/src/main/resources/data"</span>;</span><br><span class="line">        <span class="type">Indexer</span> <span class="variable">indexer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">indexNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            indexer = <span class="keyword">new</span> <span class="title class_">Indexer</span>(indexDir);</span><br><span class="line">            indexNum = indexer.indexALl(dataDir);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">assert</span> indexer != <span class="literal">null</span>;</span><br><span class="line">                indexer.close();</span><br><span class="line">            } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"Index "</span> + indexNum + <span class="string">" files, cost "</span> + (endTime - startTime) + <span class="string">" ms"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="æ£€ç´¢"><a href="#æ£€ç´¢" class="headerlink" title="æ£€ç´¢"></a>æ£€ç´¢</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.standard.StandardAnalyzer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.DirectoryReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.IndexReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.IndexSearcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.Query;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.ScoreDoc;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.TopDocs;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.FSDirectory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Searcher</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">search</span><span class="params">(String indexDir, String q)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="comment">// ç´¢å¼•æ‰€åœ¨è·¯å¾„</span></span><br><span class="line">        <span class="type">Directory</span> <span class="variable">dir</span> <span class="operator">=</span> FSDirectory.open(Paths.get(indexDir));</span><br><span class="line">        <span class="type">IndexReader</span> <span class="variable">reader</span> <span class="operator">=</span> DirectoryReader.open(dir);</span><br><span class="line">        <span class="type">IndexSearcher</span> <span class="variable">searcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(reader);</span><br><span class="line">        <span class="comment">// åˆ›å»ºæŸ¥è¯¢è§£æå™¨</span></span><br><span class="line">        <span class="type">QueryParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryParser</span>(<span class="string">"contents"</span>, <span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>());</span><br><span class="line">        <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> parser.parse(q);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢å¹¶è®°å½•å‰åæ¡æ•°æ®</span></span><br><span class="line">        <span class="type">TopDocs</span> <span class="variable">hits</span> <span class="operator">=</span> searcher.search(query, <span class="number">10</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"Found "</span> + hits.totalHits + <span class="string">" document(s) (in "</span> + (end - start) + <span class="string">" milliseconds) that matched query '"</span> + q + <span class="string">"':"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»ç»“æœä¸­å–æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (ScoreDoc scoreDoc : hits.scoreDocs) {</span><br><span class="line">            <span class="comment">// scoreDoc.docå³docIDï¼Œæ ¹æ®è¿™ä¸ªdocIDæ¥è·å–æ–‡æ¡£</span></span><br><span class="line">            <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> searcher.doc(scoreDoc.doc);</span><br><span class="line">            System.out.println(doc.get(<span class="string">"fullPath"</span>));</span><br><span class="line">        }</span><br><span class="line">        reader.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">indexDir</span> <span class="operator">=</span> <span class="string">"~/JavaProjects/luceneDemo/src/main/resources/Index"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">q</span> <span class="operator">=</span> <span class="string">"speakers"</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            search(indexDir, q);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å¢åˆ æ”¹æŸ¥æµ‹è¯•"><a href="#å¢åˆ æ”¹æŸ¥æµ‹è¯•" class="headerlink" title="å¢åˆ æ”¹æŸ¥æµ‹è¯•"></a>å¢åˆ æ”¹æŸ¥æµ‹è¯•</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.Analyzer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.analysis.standard.StandardAnalyzer;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.Document;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.StringField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.document.TextField;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.index.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.search.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.Directory;</span><br><span class="line"><span class="keyword">import</span> org.apache.lucene.store.FSDirectory;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexingTest</span> {</span><br><span class="line">    <span class="keyword">private</span> Directory dir;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] ids = {<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>};</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] tools = {<span class="string">"Lucene"</span>, <span class="string">"ElasticSearch"</span>, <span class="string">"Solr"</span>};</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] positions = {<span class="string">"Java Engineer"</span>, <span class="string">"DevOps Engineer"</span>, <span class="string">"Data Engineer"</span>};</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] descs = {</span><br><span class="line">            <span class="string">"Lucene is a full-featured text search engine library written entirely in Java."</span>,</span><br><span class="line">            <span class="string">"ElasticSearch is a distributed, RESTful search and analytics engine capable of solving a growing number of use cases."</span>,</span><br><span class="line">            <span class="string">"Solr is the popular, blazing-fast, open source enterprise search platform built on Apache Lucene."</span></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIndexAdd</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">IndexWriter</span> <span class="variable">writer</span> <span class="operator">=</span> getWriter();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; ids.length; i++) {</span><br><span class="line">            <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">            doc.add(<span class="keyword">new</span> <span class="title class_">StringField</span>(<span class="string">"id"</span>, ids[i], StringField.Store.YES));</span><br><span class="line">            doc.add(<span class="keyword">new</span> <span class="title class_">StringField</span>(<span class="string">"tool"</span>, tools[i], StringField.Store.YES));</span><br><span class="line">            doc.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">"position"</span>, positions[i], TextField.Store.YES));</span><br><span class="line">            <span class="comment">// TextField field = new TextField("position", poitions[i], StringField.Store.YES);</span></span><br><span class="line">            <span class="comment">// if("DevOps Engineer".equals(positions[i])){</span></span><br><span class="line">            <span class="comment">//     field.setBoost(1.5f);</span></span><br><span class="line">            <span class="comment">// }</span></span><br><span class="line">            <span class="comment">// doc.add(field);</span></span><br><span class="line">            doc.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">"desc"</span>, descs[i], StringField.Store.YES));</span><br><span class="line">            writer.addDocument(doc);</span><br><span class="line">        }</span><br><span class="line">        writer.commit();</span><br><span class="line">        writer.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IndexWriter <span class="title function_">getWriter</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">String</span> <span class="variable">indexDir</span> <span class="operator">=</span> <span class="string">"~/JavaProjects/luceneDemo/src/main/resources/testIndex"</span>;</span><br><span class="line">        dir = FSDirectory.open(Paths.get(indexDir));</span><br><span class="line">        <span class="type">Analyzer</span> <span class="variable">analyzer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>();</span><br><span class="line">        <span class="type">IndexWriterConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(analyzer);</span><br><span class="line">        <span class="type">IndexWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(dir, config);</span><br><span class="line">        <span class="keyword">return</span> writer;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIndexWriterNum</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">IndexWriter</span> <span class="variable">writer</span> <span class="operator">=</span> getWriter();</span><br><span class="line">        System.out.println(<span class="string">"Total number of documents in this testIndexAdd: "</span> + writer.numDocs());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBeforeMerge</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">IndexWriter</span> <span class="variable">writer</span> <span class="operator">=</span> getWriter();</span><br><span class="line">        System.out.println(<span class="string">"Total number of documents in this testIndexAdd before delete: "</span> + writer.numDocs());</span><br><span class="line">        writer.deleteDocuments(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"id"</span>, <span class="string">"1"</span>));</span><br><span class="line">        writer.commit();</span><br><span class="line">        System.out.println(<span class="string">"Max number of documents in this testIndexAdd after delete: "</span> + writer.maxDoc());</span><br><span class="line">        System.out.println(<span class="string">"Total number of documents in this testIndexAdd after delete: "</span> + writer.numDocs());</span><br><span class="line">        writer.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteAfterMerge</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">IndexWriter</span> <span class="variable">writer</span> <span class="operator">=</span> getWriter();</span><br><span class="line">        System.out.println(<span class="string">"Total number of documents in this testIndexAdd before delete: "</span> + writer.numDocs());</span><br><span class="line">        writer.deleteDocuments(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"id"</span>, <span class="string">"1"</span>));</span><br><span class="line">        writer.forceMergeDeletes();</span><br><span class="line">        writer.commit();</span><br><span class="line">        System.out.println(<span class="string">"Max number of documents in this testIndexAdd after delete: "</span> + writer.maxDoc());</span><br><span class="line">        System.out.println(<span class="string">"Total number of documents in this testIndexAdd after delete: "</span> + writer.numDocs());</span><br><span class="line">        writer.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">IndexWriter</span> <span class="variable">writer</span> <span class="operator">=</span> getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// new a document</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">        doc.add(<span class="keyword">new</span> <span class="title class_">StringField</span>(<span class="string">"id"</span>, <span class="string">"1"</span>, StringField.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> <span class="title class_">StringField</span>(<span class="string">"tool"</span>, <span class="string">"Lucene"</span>, StringField.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">"position"</span>, <span class="string">"Java Engineer"</span>, StringField.Store.YES));</span><br><span class="line">        doc.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">"desc"</span>, <span class="string">"Lucene is a full-text search engine library"</span>, StringField.Store.YES));</span><br><span class="line">        writer.updateDocument(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"id"</span>, <span class="string">"1"</span>), doc);</span><br><span class="line"></span><br><span class="line">        writer.commit();</span><br><span class="line">        writer.close();</span><br><span class="line">        System.out.println(doc.getField(<span class="string">"desc"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIndexReader</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">String</span> <span class="variable">indexDir</span> <span class="operator">=</span> <span class="string">"~/JavaProjects/luceneDemo/src/main/resources/testIndex"</span>;</span><br><span class="line">        dir = FSDirectory.open(Paths.get(indexDir));</span><br><span class="line">        <span class="type">IndexReader</span> <span class="variable">reader</span> <span class="operator">=</span> DirectoryReader.open(dir);</span><br><span class="line">        System.out.println(<span class="string">"Total number of documents in this testIndexAdd: "</span> + reader.numDocs());</span><br><span class="line">        System.out.println(<span class="string">"Total number of deleted documents in this testIndexAdd: "</span> + reader.numDeletedDocs());</span><br><span class="line">        System.out.println(<span class="string">"Total number of max docs in this testIndexAdd: "</span> + reader.maxDoc());</span><br><span class="line">        reader.close();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIndexSearch</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">String</span> <span class="variable">indexDir</span> <span class="operator">=</span> <span class="string">"~/JavaProjects/luceneDemo/src/main/resources/testIndex"</span>;</span><br><span class="line">        dir = FSDirectory.open(Paths.get(indexDir));</span><br><span class="line">        <span class="type">IndexReader</span> <span class="variable">reader</span> <span class="operator">=</span> DirectoryReader.open(dir);</span><br><span class="line">        <span class="type">IndexSearcher</span> <span class="variable">searcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(reader);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Query</span></span><br><span class="line">        <span class="type">QueryParser</span> <span class="variable">parse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryParser</span>(<span class="string">"desc"</span>, <span class="keyword">new</span> <span class="title class_">StandardAnalyzer</span>());</span><br><span class="line">        <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> parse.parse(<span class="string">"search"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æƒé‡æœç´¢æ’åº</span></span><br><span class="line">        <span class="comment">// åˆ›å»ºTermQuery</span></span><br><span class="line">        <span class="type">TermQuery</span> <span class="variable">termQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TermQuery</span>(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"position"</span>, <span class="string">"DevOps"</span>.toLowerCase()));</span><br><span class="line">        <span class="comment">// æå‡TermQueryçš„æƒé‡</span></span><br><span class="line">        <span class="type">BoostQuery</span> <span class="variable">boostQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BoostQuery</span>(termQuery, <span class="number">1.5f</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºBooleanQuery</span></span><br><span class="line">        BooleanQuery.<span class="type">Builder</span> <span class="variable">booleanQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BooleanQuery</span>.Builder();</span><br><span class="line">        booleanQuery.add(query, BooleanClause.Occur.MUST);</span><br><span class="line">        booleanQuery.add(boostQuery, BooleanClause.Occur.SHOULD);</span><br><span class="line"></span><br><span class="line">        <span class="type">TopDocs</span> <span class="variable">hits</span> <span class="operator">=</span> searcher.search(booleanQuery.build(), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Total number of hits: "</span> + hits.totalHits);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ScoreDoc scoreDoc : hits.scoreDocs) {</span><br><span class="line">            <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> searcher.doc(scoreDoc.doc);</span><br><span class="line">            System.out.println(doc.get(<span class="string">"id"</span>));</span><br><span class="line">            System.out.println(doc.get(<span class="string">"tool"</span>));</span><br><span class="line">            System.out.println(doc.get(<span class="string">"position"</span>));</span><br><span class="line">            System.out.println(doc.get(<span class="string">"desc"</span>));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        reader.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="mag-Attention"><a href="#mag-Attention" class="headerlink" title=":mag:Attention"></a><span class="github-emoji"><span>ğŸ”</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f50d.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>Attention</h4><ul>
<li><p><code>TextField</code>å’Œ<code>StringField</code>çš„åŒºåˆ«</p>
<ul>
<li><code>StringField</code>ï¼šä¸ä¼šè¢«åˆ†è¯å™¨å¤„ç†ï¼Œé€‚ç”¨äºç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼Œå¦‚IDã€æ—¥æœŸã€åˆ†ç±»ç­‰å­—æ®µï¼Œ<code>StringField.Store.YES</code>è¡¨ç¤ºå­˜å‚¨å­—æ®µå€¼ã€‚</li>
<li><p><code>TextField</code>ï¼šä¼šè¢«åˆ†è¯å™¨å¤„ç†ï¼Œé€‚ç”¨äºéœ€è¦è¿›è¡Œå…¨æ–‡æœç´¢çš„æ–‡æœ¬å†…å®¹ï¼Œå¦‚æ–‡ç« å†…å®¹ã€æè¿°ç­‰å­—æ®µï¼Œ<code>TextField.Store.YES</code>è¡¨ç¤ºå­˜å‚¨å­—æ®µå€¼å¹¶è¿›è¡Œåˆ†è¯å¤„ç†ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨StringFieldå­˜å‚¨IDå­—æ®µ</span></span><br><span class="line">doc.add(<span class="keyword">new</span> <span class="title class_">StringField</span>(<span class="string">"id"</span>, <span class="string">"1"</span>, StringField.Store.YES));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨TextFieldå­˜å‚¨æè¿°å­—æ®µ</span></span><br><span class="line">doc.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">"desc"</span>, <span class="string">"Lucene is a full-featured text search engine library written entirely in Java."</span>, TextField.Store.YES));</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
<li><p><code>IndexWriter</code>çš„<code>commit</code>å’Œ<code>close</code>æ–¹æ³•</p>
<ul>
<li><code>commit</code>ï¼šæäº¤ç´¢å¼•ï¼Œå°†å†…å­˜ä¸­çš„ç´¢å¼•å†™å…¥ç£ç›˜ï¼Œä¿è¯ç´¢å¼•çš„ä¸€è‡´æ€§ã€‚</li>
<li><code>close</code>ï¼šå…³é—­ç´¢å¼•å†™å…¥å™¨ï¼Œé‡Šæ”¾èµ„æºã€‚</li>
</ul>
</li>
<li><p><code>TermQuery</code>ä¸­çš„æ–‡æœ¬å¯ä»¥æ˜¯å¤§å†™ä¹Ÿå¯ä»¥æ˜¯å°å†™ï¼Œä½†å¿…é¡»ä¸ç´¢å¼•ä¸­çš„æ–‡æœ¬å®Œå…¨åŒ¹é…ã€‚å› ä¸º<code>TermQuery</code>ä¸ä¼šå¯¹æŸ¥è¯¢æ–‡æœ¬è¿›è¡Œåˆ†ææˆ–åˆ†è¯å¤„ç†ï¼Œæ‰€ä»¥å¦‚æœç´¢å¼•ä¸­çš„æ–‡æœ¬æ˜¯å°å†™ï¼Œé‚£ä¹ˆæŸ¥è¯¢æ–‡æœ¬ä¹Ÿå¿…é¡»æ˜¯å°å†™ã€‚å¦‚æœä½¿ç”¨äº†<code>StandardAnalyzer</code>æˆ–å…¶ä»–åˆ†è¯å™¨åœ¨ç´¢å¼•æ—¶å°†æ–‡æœ¬è½¬æ¢ä¸ºå°å†™ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢æ—¶ä¹Ÿéœ€è¦å°†æ–‡æœ¬è½¬æ¢ä¸ºå°å†™ä»¥ç¡®ä¿åŒ¹é…ã€‚å¯ä»¥ä½¿ç”¨<code>LowerCaseFilter</code>æˆ–<code>LowerCaseTokenizer</code>æ¥ç¡®ä¿æŸ¥è¯¢æ–‡æœ¬æ˜¯å°å†™çš„ã€‚</p>
  <figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºTermQueryå¹¶å°†æ–‡æœ¬è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line"><span class="type">TermQuery</span> <span class="variable">termQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TermQuery</span>(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"position"</span>, <span class="string">"DevOps"</span>.toLowerCase()));</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p><code>TermQuery</code>ä¸ä¼šè¿›è¡Œåˆ†è¯å¤„ç†ï¼Œåªä¼šè¿›è¡Œç²¾ç¡®åŒ¹é…æŸ¥è¯¢ï¼Œæ‰€ä»¥æŸ¥è¯¢æ–‡æœ¬å¿…é¡»ä¸ç´¢å¼•ä¸­çš„æ–‡æœ¬å®Œå…¨åŒ¹é…ã€‚å¦‚æœéœ€è¦æŸ¥è¯¢åŒ…å«å¤šä¸ªè¯çš„å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨<code>PhraseQuery</code>æˆ–<code>BooleanQuery</code>ã€‚</p>
  <figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨PhraseQueryæŸ¥è¯¢åŒ…å«å¤šä¸ªè¯çš„å­—æ®µ</span></span><br><span class="line"><span class="type">PhraseQuery</span> <span class="variable">phraseQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PhraseQuery</span>.Builder()</span><br><span class="line">    .add(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"position"</span>, <span class="string">"DevOps"</span>))</span><br><span class="line">    .add(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"position"</span>, <span class="string">"Engineer"</span>))</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨BooleanQueryæŸ¥è¯¢åŒ…å«å¤šä¸ªè¯çš„å­—æ®µ</span></span><br><span class="line"><span class="type">BooleanQuery</span> <span class="variable">booleanQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BooleanQuery</span>.Builder()</span><br><span class="line">    .add(<span class="keyword">new</span> <span class="title class_">TermQuery</span>(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"position"</span>, <span class="string">"DevOps"</span>)), BooleanClause.Occur.MUST)</span><br><span class="line">    .add(<span class="keyword">new</span> <span class="title class_">TermQuery</span>(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"position"</span>, <span class="string">"Engineer"</span>)), BooleanClause.Occur.MUST)</span><br><span class="line">    .build();</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>$lunece.version&gt;7.0$å·²ç»ä¸å†æ”¯æŒ<code>setBoost</code>æ–¹æ³•</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/LUCENE-6819">LUCENE-6819</a>: Index-time boosts are not supported anymore. As a replacement, index-time scoring factors should be indexed into a doc value field and combined at query time using eg. FunctionScoreQuery</li>
</ul>
</li>
<li>åŒæ ·ä¸å»ºè®®ä½¿ç”¨<code>Query.setBoost()</code>æˆ–è€…<code>Query.createWeight()</code><ul>
<li><a target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/LUCENE-6590">LUCENE-6590</a>: Query.setBoost(), Query.getBoost() and Query.clone() are gone. In order to apply boosts, you now need to wrap queries in a BoostQuery.</li>
</ul>
</li>
<li><p>å»ºè®®ç”¨<code>BoostQuery</code>å°è£…æ¥å†™æƒé‡æŸ¥è¯¢ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æƒé‡å€¼æ¥è°ƒæ•´æŸ¥è¯¢çš„ç›¸å…³æ€§ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºç›¸å…³æ€§è¶Šé«˜ã€‚å¯ä»¥å°†<code>TermQuery</code>æˆ–<code>BooleanQuery</code>åŒ…è£…åœ¨<code>BoostQuery</code>ä¸­ï¼Œç„¶åå°†<code>BoostQuery</code>æ·»åŠ åˆ°<code>BooleanQuery</code>ä¸­ã€‚</p>
  <figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºTermQuery</span></span><br><span class="line"><span class="type">TermQuery</span> <span class="variable">termQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TermQuery</span>(<span class="keyword">new</span> <span class="title class_">Term</span>(<span class="string">"position"</span>, <span class="string">"DevOps"</span>.toLowerCase()));</span><br><span class="line"><span class="comment">// æå‡TermQueryçš„æƒé‡</span></span><br><span class="line"><span class="type">BoostQuery</span> <span class="variable">boostQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BoostQuery</span>(termQuery, <span class="number">1.5f</span>);</span><br><span class="line"><span class="comment">// åˆ›å»ºBooleanQuery</span></span><br><span class="line">BooleanQuery.<span class="type">Builder</span> <span class="variable">booleanQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BooleanQuery</span>.Builder();</span><br><span class="line">booleanQuery.add(query, BooleanClause.Occur.MUST);</span><br><span class="line">booleanQuery.add(boostQuery, BooleanClause.Occur.SHOULD);</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>Copyrightï¼š </strong>
          
          Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        share
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://www.lingzhicheng.cn/2024/08/10/Lucene%20search%20engine/" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Lucene/" rel="tag">Lucene</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2024/08/13/ElasticSearch%20query%20performance%20optimization/" class="article-nav-link">
        <strong class="article-nav-caption">Prev post</strong>
        <div class="article-nav-title">
          
            ElasticSearch query performance optimization
          
        </div>
      </a>
    
    
      <a href="/2024/08/01/Python%20unzip%20split%20zip/" class="article-nav-link">
        <strong class="article-nav-caption">Next post</strong>
        <div class="article-nav-title">Python unzip split zip</div>
      </a>
    
  </nav>

  
   
<div class="gitalk" id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">


<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>

<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: 'a1a50124b0c46fa4fab9',
    clientSecret: '4a29dee6f998a9272f57ba07f987ea9eed9da5ec',
    repo: 'blog-comments',
    owner: 'boom1999',
    admin: ['boom1999'],
    // id: location.pathname,      // Ensure uniqueness and length less than 50
    id: md5(location.pathname),
    distractionFreeMode: true,  // Facebook-like distraction free mode
    pagerDirection: 'last',
    proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token'
  })

  gitalk.render('gitalk-container')
</script>

     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2024
        <span class="division">|</span> Zhicheng Ling
      </li>
    </ul>
    <ul>
      <li>
        
          
          
          Power <a href="https://hexo.io" target="_blank">Hexo</a>
          <span class="division">|</span>
          Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
          
          <span class="division">|</span>
        
          
          <span>
  <span><i class="ri-eye-fill"></i> <span id="busuanzi_value_page_pv"></span></span>
</span>
          
      </li>
    </ul>
    <ul>
      
        <li>
          <a href="http://beian.miit.gov.cn/" target="_black" rel="nofollow">æµ™ICPå¤‡2020044847å·-1</a>
        </li>
        
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/haisen-side.svg" alt="Haisenberg"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">Categories</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">Tags</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.pan.lingzhicheng.cn">Pan</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.gallery.lingzhicheng.cn">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.todo.lingzhicheng.cn">Todo</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">Friends</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/me">Me</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>è¯·æˆ‘å–æ¯å’–å•¡å§~</p>
  <div class="reward-box">
    
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->


<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto'
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // sliderå±•å¼€çŠ¶æ€
                // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // è·å¾—åŸå›¾å°ºå¯¸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.6/unpacked/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
  var ayerConfig = {
    mathjax: true
  }
</script>

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->

<!-- Graphiz -->

  <script src='https://cdnjs.cloudflare.com/ajax/libs/viz.js/1.7.1/viz.js'></script>
  <script>
    String.prototype.replaceAll = function(search, replacement) {
      var target = this;
      return target.split(search).join(replacement);
    };

    let vizObjects = document.querySelectorAll('.graphviz')

    for (let item of vizObjects) {
      let svg = undefined
      try {
        svg = Viz(item.textContent.replaceAll('â€“', '--'), 'svg')
      } catch(e) {
        svg = `<pre class="error">${e}</pre>`
      }
      item.outerHTML = svg
    }
  </script>


    
  </div>
  <script>(function(w,d, s, id) {if(typeof(w.webpushr)!=='undefined') return;w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.async=1;js.src = "https://cdn.webpushr.com/app.min.js";
  fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));
  webpushr('setup',{'key':'BL_sZtV4DqDKkZ48a4va762P0m5ke869W_4yODxaGYAZ59daIX84-6sOrZmGOxsw6bxpwPk5yKCMxalOZl3rqTA' });</script>
<script>(function (w, d, s, id) {
            if (typeof (w.webpushr) !== 'undefined') return; w.webpushr = w.webpushr || function () { (w.webpushr.q = w.webpushr.q || []).push(arguments) }; var js, fjs = d.getElementsByTagName(s)[0]; js = d.createElement(s); js.id = id; js.async = 1; js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window, document, 'script', 'webpushr-jssdk'));webpushr('setup', { 'key': 'BL_sZtV4DqDKkZ48a4va762P0m5ke869W_4yODxaGYAZ59daIX84-6sOrZmGOxsw6bxpwPk5yKCMxalOZl3rqTA' });</script></body>

</html>